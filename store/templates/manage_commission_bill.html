{% load static %}
<div class="container-fluid">
  <form action="" id="product-form">
    <input type="hidden" name="id" value="{{bills.id}}" />
    <div class="mb-3">
      <label for="brand" class="control-label">Brand</label>
      <select name="brand" id="brand" class="form-select form-control-sm rounded-0">
        {% if bills.brand %}
          <option selected value="{{bills.brand.pk}}">{{bills.brand}}</option>
        {% endif %}
        {% for item in brand %}
          <option value="{{item.pk}}">{{item.name}}</option>
        {% endfor %}
      </select>
    </div>
    <div class="mb-3">
      <label for="month" class="control-label">Month</label>
      <select
        type="text"
        id="month"
        name="month"
        class="form-select form-select-sm rounded-0"
        required
      >
        {% if bills.month == '1' %}
        <option value="1" selected>January</option>
        {% else %}
        <option value="1">January</option>
        {% endif %} {% if bills.month == '2' %}
        <option value="2" selected>February</option>
        {% else %}
        <option value="2">February</option>
        {% endif %} {% if bills.month == '3' %}
        <option value="3" selected>March</option>
        {% else %}
        <option value="3">March</option>
        {% endif %} {% if bills.month == '4' %}
        <option value="4" selected>April</option>
        {% else %}
        <option value="4">April</option>
        {% endif %} {% if bills.month == '5' %}
        <option value="5" selected>May</option>
        {% else %}
        <option value="5">May</option>
        {% endif %} {% if bills.month == '6' %}
        <option value="6" selected>June</option>
        {% else %}
        <option value="6">June</option>
        {% endif %} {% if bills.month == '7' %}
        <option value="7" selected>July</option>
        {% else %}
        <option value="7">July</option>
        {% endif %} {% if bills.month == '8' %}
        <option value="8" selected>August</option>
        {% else %}
        <option value="8">August</option>
        {% endif %} {% if bills.month == '9' %}
        <option value="9" selected>September</option>
        {% else %}
        <option value="9">September</option>
        {% endif %} {% if bills.month == '10' %}
        <option value="10" selected>October</option>
        {% else %}
        <option value="10">October</option>
        {% endif %} {% if bills.month == '11' %}
        <option value="11" selected>November</option>
        {% else %}
        <option value="11">November</option>
        {% endif %} {% if bills.month == '12' %}
        <option value="12" selected>December</option>
        {% else %}
        <option value="12">December</option>
        {% endif %}
      </select>
    </div>
    <div class="mb-3">
      <label for="bill" class="control-label">Bill</label>
      <input
        type="number"
        step="any"
        id="bill"
        name="bill"
        class="form-control form-control-sm rounded-0"
        value="{{bills.bill|floatformat}}"
        required
      />
    </div>
    <div class="mb-3">
      <label for="collect" class="control-label">Received</label>
      <input
        type="number"
        step="any"
        id="collect"
        name="collect"
        class="form-control form-control-sm rounded-0"
        value="{{bills.collect|floatformat}}"
        required
      />
    </div>

<!--    <div class="mb-3">-->
<!--      <label for="description" class="control-label">Description</label>-->
<!--      <textarea-->
<!--        rows="3"-->
<!--        id="description"-->
<!--        name="description"-->
<!--        class="form-control form-control-sm rounded-0"-->
<!--        required-->
<!--      >-->
<!--{{product.description}}</textarea-->
<!--      >-->
<!--    </div>-->
    <div class="mb-3">
      <label for="status" class="control-label">Status</label>
      <select
        type="text"
        id="status"
        name="status"
        class="form-select form-select-sm rounded-0"
        required
      >
        {% if bills.status == '1' %}
        <option value="1" selected>Unpaid</option>
        {% else %}
        <option value="1">Unpaid</option>
        {% endif %} {% if bills.status == '2' %}
        <option value="2" selected>Paid</option>
        {% else %}
        <option value="2">Paid</option>
        {% endif %}
      </select>
    </div>
  </form>
</div>
<script>
  $(function () {
    $("#product-form").submit(function (e) {
      e.preventDefault();
      var _this = $(this);
      $(".err-msg").remove();
      var el = $("<div>");
      el.addClass("alert alert-danger err-msg");
      el.hide();
      if (_this[0].checkValidity() == false) {
        _this[0].reportValidity();
        return false;
      }
      start_loader();
      $.ajax({
        headers: {
          "X-CSRFToken": "{{csrf_token}}",
        },
        url: "{% url 'save-commission-bill' %}",
        data: new FormData($(this)[0]),
        cache: false,
        contentType: false,
        processData: false,
        method: "POST",
        type: "POST",
        dataType: "json",
        error: (err) => {
          console.log(err);
          alert("An error occured", "error");
          end_loader();
        },
        success: function (resp) {
          if (typeof resp == "object" && resp.status == "success") {
            location.href = "{% url 'commission-bill-page' %}";
          } else if (resp.status == "failed" && !!resp.msg) {
            el.text(resp.msg);
          } else {
            el.text("An error occured", "error");
            end_loader();
            console.err(resp);
          }
          _this.prepend(el);
          el.show("slow");
          $("html, body, .modal").scrollTop(0);
          end_loader();
        },
      });
    });
  });

</script>

